<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }}</title>

    <meta name="csrf-token" content="{{ csrf_token }}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="post-{{ post.id }}">
        <h2>{{ post.title }}</h2>
        <p>{{ post.content }}</p>

        <!-- –õ–∞–π–∫–∏ -->
        <button id="like-btn" data-post-id="{{ post.id }}">
            {% if request.user in post.likes.all %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
            <span id="like-count">{{ post.likes.count }}</span>
        </button>

        <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
        <button id="favorite-btn" data-post-id="{{ post.id }}">
            {% if request.user in post.favorites.all %}‚≠ê{% else %}‚ú©{% endif %}
        </button>
    </div>

    <script>
    $(document).ready(function() {
        // –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –∏–∑ meta-—Ç–µ–≥–∞
        const csrfToken = $('meta[name="csrf-token"]').attr('content');

        // –õ–∞–π–∫–∏
        $('#like-btn').click(function(e) {
            e.preventDefault();
            const postId = $(this).data('post-id');

            $.ajax({
                url: `/like/1/`,
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken
                },
                success: function(response) {
                    $('#like-btn').html(response.liked ? '‚ù§Ô∏è' : 'ü§ç');
                    $('#like-count').text(response.total_likes);
                },
                error: function(xhr) {
                    console.error('–û—à–∏–±–∫–∞:', xhr.status, xhr.responseText);
                    alert('–û—à–∏–±–∫–∞ –ª–∞–π–∫–∞! –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å (F12)');
                }
            });
        });

        // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        $('#favorite-btn').click(function(e) {
            e.preventDefault();
            const postId = $(this).data('post-id');

            $.ajax({
                url: `/favorite/1/`,
                type: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken
                },
                success: function(response) {
                    $('#favorite-btn').html(response.favorited ? '‚≠ê' : '‚ú©');
                },
                error: function(xhr) {
                    console.error('–û—à–∏–±–∫–∞:', xhr.status, xhr.responseText);
                }
            });
        });
    });
    </script>
</body>
</html>